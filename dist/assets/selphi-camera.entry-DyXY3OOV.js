import{r as g,j as n,L as a,i as r,q as d,h as c,k as h,s as p,F as u,m}from"./widget-button_2.entry-H4w1ad_x.js";import"./index-DIpoLPma.js";import"./store-88a4e8c3-BR2RF-gK.js";import"./translations-d180e65d-Bu5TNlG5.js";import"./workflow.store-a1a1bec6-BlC0WLyn.js";import"./browser-6b4c8cad-DKsL9QIc.js";import"./_commonjsHelpers-1789f0cf-Cpj98o6Y.js";import"./index-oKrUFxR5.js";/*!
 * Built with Stencil
 * Copyright (c) 2024 Facephi Biometria, S.A.
 */const v=".camera-wrapper{box-sizing:border-box;overflow:hidden;aspect-ratio:1/1;height:100%;border-radius:50%;border-style:solid;border-color:transparent;border-width:var(--progress-bar-width);background-origin:border-box;background-repeat:no-repeat;background-image:var(--color-progress-bar-background);transform:translate3d(0, 0, 0);transition:background-image 0.1s cubic-bezier(0.89, 0.36, 0.13, 0.55)}.loading-camera{background-color:var(--color-loading-camera-background);border-color:var(--color-background)}.camera{position:absolute;left:50%;top:50%;transition:0.5s;display:flex;justify-content:center;align-items:center}.liveness-success{background-color:var(--color-capture-success)}.liveness-fail{background-color:var(--color-capture-warning)}.filtered{filter:brightness(0.75)}.no-filtered{filter:brightness(1)}.wider-video{width:unset;height:100%}.higher-video{width:100%;height:unset}.face-rectangle{position:absolute;right:0px;top:0px;width:0px;height:0px;border:5px solid var(--color-capture-fail);background-color:transparent;z-index:100;border-radius:50%}",f=v,b=class{constructor(e){g(this,e),this.spinnerColorClass={success:"liveness-success",fail:"liveness-fail",none:""},this.fileTag="camera-component",this.videoStream=void 0,this.cameraProgress=0,this.cameraMovement=void 0,this.cameraMirror=void 0,this.errorSpinnerColor=!1,this.faceExtracted=void 0,this.videoAspectRatio=void 0,this.loadingCamera=!0}handleSwitchVideoStream(e,t){e!==t&&(this.loadingCamera=!0,this.setVideoSource(e,t))}handleFaceExtracted(e,t){e!==t&&n.debug&&this.drawFaceExtractedRect(this.faceExtracted)}setVideoSource(e,t=void 0){this.videoElement.pause();const i=e.getVideoTracks()[0],s=i.getCapabilities?i.getCapabilities():i.getSettings();if(a.printDebug(this.fileTag,"Selected Camera to play with Id: ",s.deviceId,"Name: ",i.label,"FacingMode: ",s.facingMode),this.videoElement.onloadeddata=()=>{this.videoElement.play().then(()=>{this.loadingCamera=!1,window.screen.orientation.type.includes("landscape")&&(r.videoAspectRatio="wider-video",r.previewViewObjectFit="fill"),r.userCameraLoaded=!0,a.printDebug(this.fileTag,`Camera streaming success. New camera with id: ${s.deviceId}`)}).catch(o=>{a.printDebug(this.fileTag,"Camera streaming unsuccess."),a.printDebug(this.fileTag,o)})},this.videoElement.srcObject=null,this.videoElement.srcObject=e,t){const o=t.getVideoTracks();for(const l of o)l.stop()}}drawFaceExtractedRect(e){this.faceRectangle&&(this.faceRectangle.style.right=`${((e==null?void 0:e.x)-(e==null?void 0:e.width))/1.7}px`,this.faceRectangle.style.top=`${(e==null?void 0:e.y)/2}px`,this.faceRectangle.style.width=`${(e==null?void 0:e.width)/1.5}px`,this.faceRectangle.style.height=`${(e==null?void 0:e.height)/1.6}px`)}useLivenessDiagnosticInSpinner(e){let t;return e===d.LivenessDetected?t=this.spinnerColorClass.success:[d.Analizing,null].includes(e)?t=this.spinnerColorClass.none:t=this.spinnerColorClass.fail,t}componentDidLoad(){this.videoElement=this.cameraComponent.querySelector(".camera"),this.setVideoSource(this.videoStream),n.debug&&(this.faceRectangle=this.cameraComponent.querySelector(".face-rectangle"),this.drawFaceExtractedRect(this.faceExtracted))}componentDidRender(){const e=this.cameraComponent,t=this.cameraComponent.querySelector("video");r.cameraContainerBoundingRect=e.getBoundingClientRect(),r.videoTagBoundingRect=t.getBoundingClientRect()}render(){return c(u,null,c("div",{key:"61164a1c636ea3bee9930093d157c6c608b5b4ff",class:`camera-wrapper ${this.loadingCamera&&"loading-camera"} ${this.useLivenessDiagnosticInSpinner(h.diagnostic)}`,style:{backgroundImage:`conic-gradient(
						${this.errorSpinnerColor?"var(--color-capture-fail)":"var(--color-progress-bar)"} ${this.cameraProgress*3.6}deg,
						${this.errorSpinnerColor?"var(--color-capture-fail)":"var(--color-progress-bar-background)"} ${this.cameraProgress*3.6}deg
					)`}},c("video",{key:"95e4e9f5f0fd1d483e9199b8274ae2614d3ccad1",class:`camera ${r.videoAspectRatio} ${this.errorSpinnerColor?"filtered":"no-filtered"}`,style:{transform:`translate(-50%, -50%) scaleX(${this.cameraMirror===p.User?-1:1}) rotate(${90*n.cameraRotation}deg)`,left:this.cameraMovement},playsInline:!0,muted:!0,controls:!1})),!1)}get cameraComponent(){return m(this)}static get watchers(){return{videoStream:["handleSwitchVideoStream"],faceExtracted:["handleFaceExtracted"]}}};b.style=f;export{b as selphi_camera};
